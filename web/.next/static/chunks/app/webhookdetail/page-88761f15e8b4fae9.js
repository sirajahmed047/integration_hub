(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[76],{4938:function(e,o,t){Promise.resolve().then(t.bind(t,5127))},5127:function(e,o,t){"use strict";t.r(o),t.d(o,{default:function(){return WebhookDetail}});var i=t(7437),a=t(2265),n=t(4829);let WebhookService=class WebhookService{async executeWebhook(e){try{console.log("Executing webhook with config:",e);let o=await (0,n.Z)({method:e.method,url:e.endpoint,headers:e.headers||{}});console.log("External API response:",o.data);let t=this.transformData(o.data,e.mapping);return console.log("Transformed data:",t),e.isTestMode||await this.sendToEnvizi(t,e.envizi),{success:!0,data:t,testMode:e.isTestMode,originalData:o.data}}catch(e){throw console.error("Webhook execution failed:",e),e}}transformData(e,o){let t={};for(let i of o){let o=this.getNestedValue(e,i.sourceField);i.transformation&&(o=this.applyTransformation(o,i.transformation)),this.setNestedValue(t,i.targetField,o)}return t}async sendToEnvizi(e,o){let t={Authorization:"Bearer ".concat(o.apiKey),"Content-Type":"application/json"};await n.Z.post("".concat(o.endpoint,"/organizations/").concat(o.organizationId,"/data"),e,{headers:t})}getNestedValue(e,o){return o.split(".").reduce((e,o)=>null==e?void 0:e[o],e)}setNestedValue(e,o,t){let i=o.split("."),a=i.pop(),n=i.reduce((e,o)=>(e[o]=e[o]||{},e[o]),e);n[a]=t}applyTransformation(e,o){switch(o){case"toUpperCase":return String(e).toUpperCase();case"toLowerCase":return String(e).toLowerCase();case"toNumber":return Number(e);default:return e}}constructor(e){this.baseUrl=e,this.enviziApiUrl="https://usapi.envizi.com/api",this.enviziApiKey="eyJhbGciOiJIUzUxMiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjYzMjM5MDYyLWM1NWUtNDdlNC1hYWFjLWQ0YTFhYWRhZDFiNSIsIm5hbWUiOiJqcDAwNzgwOTk4QHRlY2htYWhpbmRyYS5jb20iLCJzdWIiOiIxNzAwNzIzOSIsImVtYWlsIjoianAwMDc4MDk5OEB0ZWNobWFoaW5kcmEuY29tIiwianRpIjoiZjg0Y2YzZTUtMDQxNS00N2NjLTllMzQtNjUyYThhMmQ4Nzc1Iiwic2NvcGUiOlsiYXBpOm1ldGE6cmVhZCIsImFwaTpyZXBvcnQ6cmVhZCJdLCJuYmYiOjE3Mzc5NjI3NjYsImV4cCI6MjE0NzQ3MjAwMCwiaWF0IjoxNzM3OTM2MDAwLCJpc3MiOiJlbnZpemkuY29tIiwiYXVkIjoiYXBpLmVudml6aS5jb20ifQ.L_LGtBbJrsSnqWUEOUY4CJHZwpqaVEb6b5V4W6R0gUBZwK-rhkUa9DibncdoTSfm4q7XhpOK7ap9M96HPdCuyw",this.enviziOrgId="17000181"}};var s=t(4659);function WebhookDetail(){let[e,o]=(0,a.useState)(null),[t,n]=(0,a.useState)(!1),[l,r]=(0,a.useState)(null),c=new WebhookService("http://localhost:3000/api");(0,a.useEffect)(()=>{let e=new URLSearchParams(window.location.search),o=e.get("id");o&&loadConfig(o)},[]);let loadConfig=async e=>{n(!0);try{let t=await fetch("/api/webhooks/".concat(e)),i=await t.json();o(i)}catch(e){console.error("Failed to load webhook config:",e)}finally{n(!1)}},handleSave=async()=>{if(e){n(!0);try{await fetch("/api/webhooks",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}catch(e){console.error("Failed to save webhook config:",e)}finally{n(!1)}}},handleTest=async()=>{if(e){n(!0);try{let o={...e,isTestMode:!0},t=await c.executeWebhook(o);r(t),console.log("Webhook test result:",t)}catch(e){console.error("Webhook test failed:",e),r({error:(null==e?void 0:e.message)||"Unknown error occurred"})}finally{n(!1)}}},handleExecute=async()=>{if(e){n(!0);try{let o={...e,isTestMode:!1},t=await c.executeWebhook(o);r(t),console.log("Webhook execution result:",t)}catch(e){console.error("Webhook execution failed:",e),r({error:(null==e?void 0:e.message)||"Unknown error occurred"})}finally{n(!1)}}};return t?(0,i.jsx)(s.gbz,{}):(0,i.jsx)(s.rjZ,{children:(0,i.jsxs)(s.sgG,{lg:16,md:8,sm:4,children:[(0,i.jsx)("h1",{children:"Webhook Configuration"}),(0,i.jsx)(s.oil,{id:"webhook-name",labelText:"Name",value:(null==e?void 0:e.name)||"",onChange:e=>o(o=>({...o,name:e.target.value}))}),(0,i.jsx)(s.oil,{id:"webhook-name",labelText:"Endpoint",value:(null==e?void 0:e.endpoint)||"",onChange:e=>o(o=>({...o,endpoint:e.target.value}))}),(0,i.jsx)(s.oil,{id:"webhook-name",labelText:"Envizi API Key",type:"password",value:(null==e?void 0:e.envizi.apiKey)||"",onChange:e=>o(o=>({...o,envizi:{...o.envizi,apiKey:e.target.value}}))}),(0,i.jsxs)("div",{style:{marginTop:"1rem"},children:[(0,i.jsx)(s.zxk,{onClick:handleSave,children:"Save"}),(0,i.jsx)(s.zxk,{onClick:handleTest,children:"Test Webhook"}),(0,i.jsx)(s.zxk,{onClick:handleExecute,disabled:!(null==e?void 0:e.envizi.apiKey),style:{marginLeft:"1rem"},children:"Execute Webhook"})]})]})})}}},function(e){e.O(0,[501,513,829,971,472,744],function(){return e(e.s=4938)}),_N_E=e.O()}]);